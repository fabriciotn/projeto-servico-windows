LPARAMETERS REQUISICAO

SET PATH TO c:\ProjHJK
SET EXCLUSIVE OFF
SET DELETED ON
SET CENTURY ON
SET DATE BRITISH
SET SAFETY OFF

IF(PARAMETERS() <= 0)
	REQUISICAO = INPUTBOX("DIGITE O NÚMERO DA REQUISIÇÃO","NUMERO DA REQUISIÇÃO")
ENDIF

wait window "Aguarde, processando..." NOWAIT

SELECT D04.AMOSTRA, ;
	'|', ;
	D04.COMPONENTE, ;
	'|', ;
	D04.TB, ; 
	'|', ;
	D04.SAGM, ;
	'|', ;
	E04.GRSANGUE, ;
	'|', ;
    E04.RH, ;
	'|', ;
	D04.DATA_MOV, ;
	'|', ;
	E09.HBS, ;
	'|', ;
	E04.LISSC AS PAI, ;
	'|', ;
	IIF(E10.CDE = 'P', 'P', IIF(E10.CDE = 'N', 'N', ' ')) AS CDE, ;
	'|', ;
	D15.VOLUME, ;
	'|', ;
	E01.INICIAIS, ;
	'|', ;
	diajuliano(SUBSTR(E02.AMOSTRA,3,4),VAL(SUBSTR(E02.AMOSTRA,7,3))) AS DATA, ;
	'|', ;
	'01011900' AS VALIDADE, ;
	'|' ;
FROM HMAF\HMAFD15 AS D15, ;
	HMAE\D04_HMAE AS E04, ;
	HMAE\D02_HMAE AS E02, ;
	HMAE\D01_HMAE AS E01, ;
	HMAE\D09_HMAE AS E09, ;
	HMAF\HMAFD04 AS D04 ;
LEFT JOIN HMAE\D10_HMAE AS E10 ;
ON D04.AMOSTRA = E10.AMOSTRA ;
WHERE D04.CODREQUIS =  REQUISICAO ;
	AND D04.AMOSTRA = E04.AMOSTRA ;
	AND D04.AMOSTRA = D15.AMOSTRA ;
	AND D04.AMOSTRA = E02.AMOSTRA ; 
	AND D04.AMOSTRA = E09.AMOSTRA ;
	AND E02.NUMDOADOR = E01.NUMDOADOR ;
INTO CURSOR TESTE
	
COPY TO &REQUISICAO TYPE SDF